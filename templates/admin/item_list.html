{% extends "admin/base.html" %}
{% block title %}Login{% endblock %}

{% block content %}
<div class="center-wrapper">
    <div class="card">
        <h2 style="text-align:center;">Product List</h2>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, message in messages %}
        <p style="color:green;text-align:center;">{{ message }}</p>
        {% endfor %}
        {% endwith %}


        <div style="text-align:right;margin-bottom:15px;">
            <a href="/admin/add-item" class="btn">+ Add Product</a>
        </div>

        <form method="GET" action="/admin-dashboard" class="search-filter-form">
            <input type="text" name="search" placeholder="Search product..."
                value="{{ request.args.get('search', '') }}">

            <select name="category">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat.category }}" {% if request.args.get('category')==cat.category %}selected{% endif
                    %}>
                    {{ cat.category }}
                </option>
                {% endfor %}
            </select>

            <button type="submit">Search</button>
        </form>

        <table class="product-table">
            <tr>
                <th>ID</th>
                <th>Image</th>
                <th>Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>View</th>
                <th>Update</th>
                <th>Delete</th>
            </tr>

            {% if products %}
            {% for product in products %}
            <tr>
                <td>{{ product.product_id }}</td>

                <td>
                    <img src="/static/uploads/product_images/{{ product.image }}" class="product-img">
                </td>

                <td>{{ product.name }}</td>
                <td>{{ product.category }}</td>
                <td>â‚¹{{ product.price }}</td>

                <!-- VIEW -->
                <td>
                    <a href="/admin/view-item/{{ product.product_id }}" class="action view">View</a>
                </td>

                <!-- UPDATE -->
                <td>
                    <a href="/admin/update-item/{{ product.product_id }}" class="action update">Update</a>
                </td>

                <!-- DELETE -->
                <td>
                    <form action="/admin/delete-item/{{ product.product_id }}" method="POST"
                        onsubmit="return confirm('Are you sure you want to delete this product?');">
                        <button type="submit" class="action delete">
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="8" style="text-align:center;color:gray;">
                    No products found
                </td>
            </tr>
            {% endif %}
        </table>

    </div>
</div>
{% endblock %}