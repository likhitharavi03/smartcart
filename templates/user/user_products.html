{% extends "user/base.html" %}
{% block title %}All Products{% endblock %}

{% block content %}
<div class="page-container">
    <center>
    <h2 class="page-title">All Products</h2>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
    <p class="flash-message {{ category }}">{{ message }}</p>
    {% endfor %}
    {% endwith %}
    <hr>
        <!-- Search + Filter Row -->
    <div class="filter-row">

        <form method="GET" action="/user/products">
            <input type="text" name="search" placeholder="Search product..."
                value="{{ request.args.get('search', '') }}">
            <button type="submit">Search</button>
        </form>
        <form method="GET" action="/user/products">
            <select name="category">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat.category }}" {% if request.args.get('category')==cat.category %} selected {% endif
                    %}>
                    {{ cat.category }}
                </option>
                {% endfor %}
            </select>
            <button type="submit">Filter</button>
        </form>

    </div>
    <br>
    <a href="/user-home" class="btn">Back to Dashboard</a>
    <!-- Product Cards -->
    <div class="product-container">
        {% if products %}
        {% for product in products %}
        <div class="product-card">
            <img src="{{ url_for('static', filename='uploads/product_images/' ~ product.image) }}"
                alt="{{ product.name }}">
            <h3>{{ product.name }}</h3>
            <p>{{ product.category }}</p>
            <p class="price">â‚¹{{ product.price }}</p>
            <a href="{{ url_for('user_product_details', product_id=product.product_id) }}" class="btn">
                View Details
            </a>
        </div>
        {% endfor %}
        {% else %}
        <p>No products found.</p>
        {% endif %}
    </div>
    </center>
</div>
{% endblock %}